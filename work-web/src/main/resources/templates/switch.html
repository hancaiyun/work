<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>开关配置</title>
    <link rel="stylesheet"  type="text/css" href="../frame/layui/css/layui.css">
    <link rel="stylesheet"  type="text/css" href="../frame/static/css/style.css">
    <link rel="icon" href="../frame/static/image/code.png">
</head>
<body class="body">

<blockquote class="layui-elem-quote layui-text layui-bg-blue">
    1、双数据源切换控制，目前支持MongoDB、MySQL的切换<br/>
    2、缓存机制的开关控制
</blockquote>

<fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
    <legend>数据源切换开关</legend>
</fieldset>

<form class="layui-form" action="">
    <div class="layui-form-item">
        <label class="layui-form-label">数据源切换</label>
        <div class="layui-input-inline">
            <label>
                <select name="datasource">
                    <option value=""></option>
                    <option value="MYSQL">MySQL</option>
                    <option value="MONGODB">MongoDB</option>
                </select>
            </label>
        </div>
        <button class="layui-btn" id="getSwitch">提交</button>
    </div>
</form>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 50px;">
    <legend>缓存开关（Redis）</legend>
</fieldset>
<form class="layui-form layui-form-pane" action="">
    <div class="layui-form-item" pane="">
        <label class="layui-form-label">开关</label>
        <div class="layui-input-block">
            <input type="checkbox" checked="" name="" lay-skin="switch" lay-filter="cache" title="开关">
        </div>
    </div>
</form>

<script src="../frame/layui/layui.js" charset="utf-8"></script>

<!--开关监听-->
<script>
    layui.use(['form','layer'], function(){
        var form = layui.form;
        var layer = layui.layer;
        var $ = layui.jquery;

        //1、监听按钮-数据源切换提交
        $("#getSwitch").click(function() {
            var v = document.getElementsByTagName("select")[0].value;
            //控制未选择点击事件
            if(v === ""){
                layer.open({
                    title: '提示信息'
                    , content: '请选择要切换的数据源'
                });
                alert("请选择要切换的数据源");
                return;
            }

            $.ajax({
                url:'/changer/switchCheck' + '?datasource=' + v,//地址
                dataType:'json',//数据类型
                type:'GET',//类型
                timeout:3000,//超时
                //请求成功
                success:function(res){
                    if(res.code === '0000') {
                        layer.open({
                            title: '提示信息'
                            , content: '数据源切换成功'
                        });
                        alert("数据源切换成功");
                    }else{
                        alert("切换失败，失败信息:" + res.data.msg)
                    }
                },
                //失败/超时
                error:function(XMLHttpRequest,textStatus,errorThrown){
                    if(textStatus==='timeout'){
                        alert('請求超時');
                        setTimeout(function(){
                            alert('重新请求');
                        },3000);
                    }
                    alert(errorThrown);
                }
            })
        });

        //2、监听缓存开关切换
        form.on('switch(cache)', function(data){
            layer.msg('开关checked：'+ (this.checked ? 'true' : 'false'), {
                offset: '6px'
            });
            layer.tips('温馨提示：请注意开关状态的文字可以随意定义，而不仅仅是ON|OFF', data.othis)
        });
    });
</script>

</body>
</html>